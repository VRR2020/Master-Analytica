{"version":3,"file":"node-build.mjs","sources":["../../server/routes/demo.ts","../../server/routes/contact.ts","../../server/routes/track.ts","../../server/index.ts","../../server/node-build.ts"],"sourcesContent":["import { RequestHandler } from \"express\";\nimport { DemoResponse } from \"@shared/api\";\n\nexport const handleDemo: RequestHandler = (req, res) => {\n  const response: DemoResponse = {\n    message: \"Hello from Express server\",\n  };\n  res.status(200).json(response);\n};\n","import { RequestHandler } from \"express\";\nimport { z } from \"zod\";\n\nconst ContactFormSchema = z.object({\n  name: z.string().min(1, \"Name is required\"),\n  email: z.string().email(\"Invalid email\"),\n  company: z.string().optional().default(\"\"),\n  phone: z.string().optional().default(\"\"),\n  message: z.string().min(1, \"Message is required\"),\n});\n\ntype ContactFormData = z.infer<typeof ContactFormSchema>;\n\nexport const handleContact: RequestHandler = async (req, res) => {\n  try {\n    // Validate request data\n    const validatedData = ContactFormSchema.parse(req.body);\n\n    // Get visitor info\n    const clientIp =\n      (req.headers[\"x-forwarded-for\"] as string)?.split(\",\")[0].trim() ||\n      req.socket.remoteAddress ||\n      \"unknown\";\n\n    // Store in database/log (for now, just log it)\n    const leadData = {\n      timestamp: new Date().toISOString(),\n      name: validatedData.name,\n      email: validatedData.email,\n      company: validatedData.company,\n      phone: validatedData.phone,\n      message: validatedData.message,\n      clientIp,\n      userAgent: req.headers[\"user-agent\"] || \"unknown\",\n    };\n\n    console.log(\"New lead submitted:\", leadData);\n\n    // In a production app, you would:\n    // 1. Send email notification\n    // 2. Store in database\n    // 3. Track user location/analytics\n    // For now, we'll just acknowledge receipt\n\n    res.status(200).json({\n      success: true,\n      message: \"Contact form submitted successfully\",\n    });\n  } catch (error) {\n    if (error instanceof z.ZodError) {\n      return res.status(400).json({\n        success: false,\n        errors: error.errors.map((e) => ({\n          field: e.path.join(\".\"),\n          message: e.message,\n        })),\n      });\n    }\n\n    console.error(\"Contact form error:\", error);\n    res.status(500).json({\n      success: false,\n      message: \"Failed to process contact form\",\n    });\n  }\n};\n","import { RequestHandler } from \"express\";\n\ninterface TrackingData {\n  eventType: string;\n  page: string;\n  timestamp: string;\n  userAgent: string;\n  referrer?: string;\n  language?: string;\n}\n\nexport const handleTrack: RequestHandler = async (req, res) => {\n  try {\n    const trackingData: TrackingData = req.body;\n\n    // Get client IP\n    const clientIp =\n      (req.headers[\"x-forwarded-for\"] as string)?.split(\",\")[0].trim() ||\n      req.socket.remoteAddress ||\n      \"unknown\";\n\n    // Log visitor data (in production, store in database)\n    const enrichedData = {\n      ...trackingData,\n      clientIp,\n      timestamp: new Date().toISOString(),\n    };\n\n    console.log(\"Visitor tracked:\", enrichedData);\n\n    // In production, you would:\n    // 1. Validate data with Zod\n    // 2. Store in database (PostgreSQL, MongoDB, etc.)\n    // 3. Generate analytics reports\n    // 4. Track location based on IP\n    // 5. Store marketing-related data for later analysis\n\n    res.status(200).json({\n      success: true,\n      message: \"Tracking data received\",\n    });\n  } catch (error) {\n    console.error(\"Tracking error:\", error);\n    res.status(500).json({\n      success: false,\n      message: \"Failed to process tracking data\",\n    });\n  }\n};\n","import \"dotenv/config\";\nimport express from \"express\";\nimport cors from \"cors\";\nimport { handleDemo } from \"./routes/demo\";\nimport { handleContact } from \"./routes/contact\";\nimport { handleTrack } from \"./routes/track\";\n\nexport function createServer() {\n  const app = express();\n\n  // Middleware\n  app.use(cors());\n  app.use(express.json());\n  app.use(express.urlencoded({ extended: true }));\n\n  // Example API routes\n  app.get(\"/api/ping\", (_req, res) => {\n    const ping = process.env.PING_MESSAGE ?? \"ping\";\n    res.json({ message: ping });\n  });\n\n  app.get(\"/api/demo\", handleDemo);\n  app.post(\"/api/contact\", handleContact);\n  app.post(\"/api/track\", handleTrack);\n\n  return app;\n}\n","import path from \"path\";\nimport { createServer } from \"./index\";\nimport * as express from \"express\";\n\nconst app = createServer();\nconst port = process.env.PORT || 3000;\n\n// In production, serve the built SPA files\nconst __dirname = import.meta.dirname;\nconst distPath = path.join(__dirname, \"../spa\");\n\n// Serve static files\napp.use(express.static(distPath));\n\n// Handle React Router - serve index.html for all non-API routes\napp.get(\"*\", (req, res) => {\n  // Don't serve index.html for API routes\n  if (req.path.startsWith(\"/api/\") || req.path.startsWith(\"/health\")) {\n    return res.status(404).json({ error: \"API endpoint not found\" });\n  }\n\n  res.sendFile(path.join(distPath, \"index.html\"));\n});\n\napp.listen(port, () => {\n  console.log(`ðŸš€ Fusion Starter server running on port ${port}`);\n  console.log(`ðŸ“± Frontend: http://localhost:${port}`);\n  console.log(`ðŸ”§ API: http://localhost:${port}/api`);\n});\n\n// Graceful shutdown\nprocess.on(\"SIGTERM\", () => {\n  console.log(\"ðŸ›‘ Received SIGTERM, shutting down gracefully\");\n  process.exit(0);\n});\n\nprocess.on(\"SIGINT\", () => {\n  console.log(\"ðŸ›‘ Received SIGINT, shutting down gracefully\");\n  process.exit(0);\n});\n"],"names":["app","express"],"mappings":"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"}